!function(e){e.plot.plugins.push({init:function(t){var o={first:{x:-1,y:-1},second:{x:-1,y:-1},show:!1,active:!1},n={},i=null;function s(e){o.active&&(u(e),t.getPlaceholder().trigger("plotselecting",[c()]))}function r(s){1==s.which&&(document.body.focus(),void 0!==document.onselectstart&&null==n.onselectstart&&(n.onselectstart=document.onselectstart,document.onselectstart=function(){return!1}),void 0!==document.ondrag&&null==n.ondrag&&(n.ondrag=document.ondrag,document.ondrag=function(){return!1}),d(o.first,s),o.active=!0,i=function(e){var s;s=e,i=null,void 0!==document.onselectstart&&(document.onselectstart=n.onselectstart),void 0!==document.ondrag&&(document.ondrag=n.ondrag),o.active=!1,u(s),h()?l():(t.getPlaceholder().trigger("plotunselected",[]),t.getPlaceholder().trigger("plotselecting",[null]))},e(document).one("mouseup",i))}function c(){if(!h())return null;if(!o.show)return null;var n={},i=o.first,s=o.second;return e.each(t.getAxes(),function(e,t){if(t.used){var o=t.c2p(i[t.direction]),r=t.c2p(s[t.direction]);n[e]={from:Math.min(o,r),to:Math.max(o,r)}}}),n}function l(){var e=c();t.getPlaceholder().trigger("plotselected",[e]),e.xaxis&&e.yaxis&&t.getPlaceholder().trigger("selected",[{x1:e.xaxis.from,y1:e.yaxis.from,x2:e.xaxis.to,y2:e.yaxis.to}])}function a(e,t,o){return t<e?e:t>o?o:t}function d(e,n){var i=t.getOptions(),s=t.getPlaceholder().offset(),r=t.getPlotOffset();e.x=a(0,n.pageX-s.left-r.left,t.width()),e.y=a(0,n.pageY-s.top-r.top,t.height()),"y"==i.selection.mode&&(e.x=e==o.first?0:t.width()),"x"==i.selection.mode&&(e.y=e==o.first?0:t.height())}function u(e){null!=e.pageX&&(d(o.second,e),h()?(o.show=!0,t.triggerRedrawOverlay()):f(!0))}function f(e){o.show&&(o.show=!1,t.triggerRedrawOverlay(),e||t.getPlaceholder().trigger("plotunselected",[]))}function g(e,o){var n,i,s,r,c=t.getAxes();for(var l in c)if((n=c[l]).direction==o&&(e[r=o+n.n+"axis"]||1!=n.n||(r=o+"axis"),e[r])){i=e[r].from,s=e[r].to;break}if(e[r]||(n="x"==o?t.getXAxes()[0]:t.getYAxes()[0],i=e[o+"1"],s=e[o+"2"]),null!=i&&null!=s&&i>s){var a=i;i=s,s=a}return{from:i,to:s,axis:n}}function h(){var e=t.getOptions().selection.minSize;return Math.abs(o.second.x-o.first.x)>=e&&Math.abs(o.second.y-o.first.y)>=e}t.clearSelection=f,t.setSelection=function(e,n){var i,s=t.getOptions();"y"==s.selection.mode?(o.first.x=0,o.second.x=t.width()):(i=g(e,"x"),o.first.x=i.axis.p2c(i.from),o.second.x=i.axis.p2c(i.to)),"x"==s.selection.mode?(o.first.y=0,o.second.y=t.height()):(i=g(e,"y"),o.first.y=i.axis.p2c(i.from),o.second.y=i.axis.p2c(i.to)),o.show=!0,t.triggerRedrawOverlay(),!n&&h()&&l()},t.getSelection=c,t.hooks.bindEvents.push(function(e,t){null!=e.getOptions().selection.mode&&(t.mousemove(s),t.mousedown(r))}),t.hooks.drawOverlay.push(function(t,n){if(o.show&&h()){var i=t.getPlotOffset(),s=t.getOptions();n.save(),n.translate(i.left,i.top);var r=e.color.parse(s.selection.color);n.strokeStyle=r.scale("a",.8).toString(),n.lineWidth=1,n.lineJoin=s.selection.shape,n.fillStyle=r.scale("a",.4).toString();var c=Math.min(o.first.x,o.second.x)+.5,l=Math.min(o.first.y,o.second.y)+.5,a=Math.abs(o.second.x-o.first.x)-1,d=Math.abs(o.second.y-o.first.y)-1;n.fillRect(c,l,a,d),n.strokeRect(c,l,a,d),n.restore()}}),t.hooks.shutdown.push(function(t,o){o.unbind("mousemove",s),o.unbind("mousedown",r),i&&e(document).unbind("mouseup",i)})},options:{selection:{mode:null,color:"#e8cfac",shape:"round",minSize:5}},name:"selection",version:"1.1"})}(jQuery);